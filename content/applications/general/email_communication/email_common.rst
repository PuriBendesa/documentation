======================================================
Common issues and frequent questions related to Emails 
======================================================

This document contains an explanation of the most recurring mailing concerns.

We will start by addressing issues of outgoing emails (ex: my client has not received my email), and then, of incoming emails (ex: I do not receive responses from my customers in the database).

Outgoing emails
===============

.. _red_envelop:

What do you have to check if your email is not sent?
----------------------------------------------------

The first indicator showing you that the email has not been sent is the red envelope showing next to the date & hour of the message.
If you click on it, you will see why the message was not sent. 

.. image:: email_common/red_envelop.png
   :align: center
   :alt: Red envelop displayed in chatter

Common error messages
~~~~~~~~~~~~~~~~~~~~~

.. _daily_limit_mail:

You reached your daily limit: 
*****************************

.. image:: email_common/email_limit.png
   :align: center
   :alt: Warning in Odoo upon email limit reached

Each email service provider has its own email sending limits. The limits may be daily, hourly, and sometimes also per minute. And this is the same for Odoo. That limit is in place to prevent our e-mail servers from being blacklisted.

Here are the default limits for new databases:
 - 200 emails/day for Odoo Online and Odoo.sh databases with an active subscription,
 - 50 emails/day for one-app free and trial databases,
 - in case of migration, your daily limit might be reset to 50 emails a day.

In case you hit the limit, you can:
 - Ask our support team to increase your daily limit. We will analyze the situation of your database depending on (non-exhaustive list):

   - how many users in your database, 
   - which apps are installed,
   - your bounce ratio: the percentage of email addresses that did not receive emails because it was returned by a mail server on it's way to the final recipient. 

   You can contact the `support <https://www.odoo.com/help>`_,

 - Use your own outgoing email server and you are independent of Odoo’s mail limit (please refer to :ref: `the corresponding documentation <./email_servers.html>`_),
 - Wait around 11pm UTC for the reset and click on the retry button of the emails: The :ref:`Developer mode <developer-mode>` must be activated. Then, go to :menuselection:`Settings --> Technical --> Emails`

.. image:: email_common/email_retry_technical.png
   :align: center
   :alt: Retry button of an emails


Beware: the daily limit is global to your database and can rise quite fast! You have to know that by default an internal message, a notification, a note, … count as an email in your daily limit if it notifies someone.

You can mitigate this by receiving your :ref:`notifications in Odoo<notification_preferences>` instead of by emails. 

SMTP Error
**********

You can find out why an email wasn't transmitted successfully by reviewing the Simple Mail Transport Protocol (SMTP) error messages. SMTP is a protocol to describe the email structure and transmit it over the Internet, and the error messages generated by email services are helpful tools to diagnose and troubleshoot email problems.

No Error
********

Odoo is not always capable of providing the information on the reason it failed. The different providers implement a personalized policy of the bounce emails and it is not always possible for odoo to interpret it correctly.

If you have this problem on a recurring basis with the same client or the same domain, please do not hesitate to contact `Odoo Support <https://www.odoo.com/help>`_ for help in finding a reason.

Note: in such case, one of the most common reasons is related to :ref:`SPF <spf_compliant>` and/or :ref:`DKIM <DKIM_compliant>` configuration.

Why is my email sent late?
**************************

It may happen that you schedule a email campaign but it is not sent on time. You should know that we use a delayed job to send emails that we consider as not urgent (Newsletters concept such as mass mailing, marketing automation, events). The system utility **cron** can be used to schedule programs to run automatically at predetermined intervals. We use that policy in order to avoid cluttering the mail servers and prioritize the communication. 

The emails considered as urgent (communication from a person to another one such as Sales Order, Invoices, Purchase Orders…) are sent directly. 

.. image:: email_common/email_scheduled_later.png
   :align: center
   :alt: Email scheduled to be sent later.

By default, the Mass Mailing cron runs every 60 minutes. So, you should wait an hour before the campaign is actually sent.

Incoming emails
===============

When you have an issue with incoming emails, there might not be an indication per se in Odoo. This is the client who tries to contact a database who will get a bounce (most of the time 550: mailbox unavailable).

Emails are not received
-----------------------

Depending on the platform you are using: 
 - The **Odoo.sh** users can find their live logs on the folder ~/logs/.
 - The folder ~/logs/ (preferably accessed by the command line) of an Odoo.sh contains a list of files containing the logs of the database. The log files are created everyday at 4:00 AM UTC. The two last days are not compressed, while the older ones are, in order to gain space. The naming of the files are decremental, which means that the file named .1 is the one from yesterday and the file .2 is the day before yesterday. See the following Odoo.sh documentation about `logs <https://www.odoo.com/documentation/master/administration/odoo_sh/getting_started/branches.html?#logs>`_. Use the command ``grep`` and ``zgrep`` (for the compressed ones) to search through the files. 
 - The **SaaS** users won’t have access to their logs. However you can still contact `Odoo Support <https://www.odoo.com/help>`_ , if you have a recurring issue with the same client or domain.

Get helped from support
-----------------------

In order to get helped efficiently, please provide as much information as possible. Here is a list of what can be helpful:
 - The **EML** of the email, stating for *Electronic Mail*, is the file format containing all the technical information required for an investigation. The documentation of your own email provider might help you on how to get your EML files. Once you get the EML of the email, adding it in the attachment of your ticket is the most efficient way for us to investigate. The support will mainly focus on redundant issues.


.. seealso:: Here are links to the documentation of some common providers:

   - `GMail <https://support.google.com/mail/answer/29436>`_
   - `Outlook <https://support.microsoft.com/en-us/office/view-internet-message-headers-in-outlook-cd039382-dc6e-4264-ac74-c048563d212c#tab=Web>`_

- The exact flow you are following in order to normally receive those emails in Odoo. Here are examples of questions whose answers can be useful:
    - Is this simply a reply from an email going out from Odoo ? 
    - Are you using an incoming email server or somehow redirecting? 
    - Can you provide us with an example of an email that has been correctly forwarded ?

- Providing answers to the following questions: 
	- Is it a generic issue or is it specific to a use case? If yes, which one exactly? 
	- Is it working as expected? In case the email is sent using Odoo, the bounce email should reach the Odoo database and display the :ref:`red envelope <red_envelop>`. To be able to investigate, please refer to the subsection envelope is red.
